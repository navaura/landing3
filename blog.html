<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags - Will be updated by JavaScript -->
    <title id="page-title">Blog | NAVAURA‚Ñ¢ ARCTIQ</title>
    <meta id="page-description" name="description" content="Explore our latest insights and articles">
    <meta id="page-keywords" name="keywords" content="">
    <meta name="robots" content="index, follow, max-image-preview:large">
    
    <!-- Open Graph -->
    <meta property="og:type" content="article">
    <meta property="og:site_name" content="NAVAURA‚Ñ¢ ARCTIQ">
    <meta id="og-title" property="og:title" content="Blog | NAVAURA‚Ñ¢ ARCTIQ">
    <meta id="og-description" property="og:description" content="Explore our latest insights and articles">
    <meta id="og-image" property="og:image" content="https://www.navaura.in/default-blog-image.jpg">
    <meta id="og-url" property="og:url" content="https://www.navaura.in/blog.html">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta id="twitter-title" name="twitter:title" content="Blog | NAVAURA‚Ñ¢ ARCTIQ">
    <meta id="twitter-description" name="twitter:description" content="Explore our latest insights and articles">
    <meta id="twitter-image" name="twitter:image" content="https://www.navaura.in/default-blog-image.jpg">
    
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;500;600;800&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <style>
        /* --- CONFIGURATION --- */
        :root {
            --bg: #030303;
            --fg: #ffffff;
            --border: rgba(255, 255, 255, 0.12);
            --dim: rgba(255, 255, 255, 0.4);
            --highlight: #ffffff;
            --nav-height: 90px;
            --nav-height-mobile: 70px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            background-color: var(--bg);
            color: var(--fg);
            font-family: 'Manrope', sans-serif;
            width: 100%;
            min-height: 100vh;
        }
        
        /* Hide Scrollbar */
        html { scrollbar-width: none; -ms-overflow-style: none; }
        html::-webkit-scrollbar { display: none; }
        body { scrollbar-width: none; -ms-overflow-style: none; }
        body::-webkit-scrollbar { display: none; }
        
        a { text-decoration: none; color: inherit; }
        
        /* --- MAIN CONTENT --- */
        main {
            padding-top: var(--nav-height);
            min-height: 100vh;
            position: relative;
        }
        
        /* Grid Background */
        .bg-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(var(--border) 1px, transparent 1px),
                linear-gradient(90deg, var(--border) 1px, transparent 1px);
            background-size: 100px 100px;
            opacity: 0.1;
            pointer-events: none;
            z-index: -1;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 4rem 5% 6rem 5%;
            position: relative;
            z-index: 1;
        }
        
        /* --- LOADING & ERROR --- */
        .loading, .error {
            text-align: center;
            padding: 6rem 2rem;
            color: var(--dim);
        }
        
        .error {
            background: rgba(255, 193, 7, 0.05);
            border: 1px solid rgba(255, 193, 7, 0.2);
            border-radius: 8px;
            color: #ffc107;
            max-width: 600px;
            margin: 4rem auto;
        }
        
        .error h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #fff;
        }
        
        .error a {
            color: #ffc107;
            text-decoration: underline;
        }
        
        /* --- BLOG LIST SECTION --- */
        .blog-list-section {
            margin-bottom: 4rem;
        }
        
        .blog-list-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .blog-list-header h2 {
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 600;
            margin-bottom: 1rem;
            letter-spacing: -0.02em;
        }
        
        .blog-list-header p {
            color: var(--dim);
            font-size: 1.1rem;
            font-weight: 300;
        }
        
        .blog-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .blog-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
        }
        
        .blog-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-4px);
        }
        
        .blog-card-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 1px solid var(--border);
        }
        
        .blog-card-content {
            padding: 1.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .blog-card-date {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--dim);
            margin-bottom: 0.75rem;
        }
        
        .blog-card-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            line-height: 1.3;
            color: #fff;
        }
        
        .blog-card-summary {
            font-size: 0.95rem;
            color: var(--dim);
            line-height: 1.5;
            margin-bottom: 1rem;
            flex: 1;
        }
        
        .blog-card-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .blog-card-keyword {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            padding: 0.3rem 0.6rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 3px;
        }
        
        /* --- ARTICLE HEADER --- */
        header {
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }
        
        .back-to-list {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--dim);
            margin-bottom: 2rem;
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .back-to-list:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.3);
            color: #fff;
        }
        
        .meta {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--dim);
            margin-bottom: 2rem;
        }
        
        h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 600;
            line-height: 1.1;
            margin-bottom: 1.5rem;
            letter-spacing: -0.02em;
        }
        
        .summary {
            font-size: 1.2rem;
            line-height: 1.6;
            color: var(--dim);
            font-weight: 300;
        }
        
        /* --- FEATURED IMAGE --- */
        .featured-image {
            width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 3rem;
            border: 1px solid var(--border);
        }
        
        /* --- ARTICLE CONTENT --- */
        .content {
            font-size: 1.1rem;
            line-height: 1.8;
            font-weight: 300;
        }
        
        .content p {
            margin-bottom: 1.5rem;
            color: rgba(255, 255, 255, 0.85);
        }
        
        .content h2 {
            font-size: 2rem;
            font-weight: 600;
            margin: 3rem 0 1.5rem 0;
            letter-spacing: -0.02em;
            color: #fff;
        }
        
        .content h3 {
            font-size: 1.5rem;
            font-weight: 500;
            margin: 2.5rem 0 1rem 0;
            letter-spacing: -0.01em;
            color: rgba(255, 255, 255, 0.95);
        }
        
        /* --- KEYWORDS --- */
        .keywords {
            margin-top: 4rem;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 8px;
        }
        
        .keywords strong {
            display: block;
            margin-bottom: 1rem;
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--dim);
        }
        
        .keywords span {
            display: inline-block;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            padding: 0.5rem 1rem;
            margin: 0.5rem 0.5rem 0.5rem 0;
            border-radius: 4px;
            font-size: 0.9rem;
            font-family: 'Space Mono', monospace;
            transition: all 0.3s ease;
        }
        
        .keywords span:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        /* --- ATTRIBUTION --- */
        .attribution {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
            color: var(--dim);
            text-align: center;
        }
        
        /* --- MOBILE ADJUSTMENTS --- */
        @media (max-width: 768px) {
            main { padding-top: var(--nav-height-mobile); }
            .container { padding: 2rem 5% 4rem 5%; }
            .blog-grid { grid-template-columns: 1fr; gap: 1.5rem; }
            .blog-card-image { height: 180px; }
            h1 { font-size: 2rem; }
            .content { font-size: 1rem; }
            .content h2 { font-size: 1.5rem; }
            .content h3 { font-size: 1.25rem; }
        }
        
        /* --- HIDE/SHOW --- */
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    
    <!-- Navigation Placeholder -->
    <div id="navigation-placeholder"></div>
    
    <main>
        <div class="container">
            <!-- BLOG LIST SECTION (Shows when no blog is selected OR after reading a blog) -->
            <div id="blog-list-container" class="blog-list-section">
                <div class="blog-list-header">
                    <h2>Latest Articles</h2>
                    <p>Explore our collection of insights and stories</p>
                </div>
                <div id="blog-grid" class="blog-grid">
                    <div class="loading">Loading blogs...</div>
                </div>
            </div>
            
            <!-- INDIVIDUAL BLOG CONTENT (Shows when a blog is selected) -->
            <div id="blog-content" class="hidden"></div>
            
            <!-- MORE ARTICLES SECTION (Shows after reading a blog) -->
            <div id="more-articles-container" class="blog-list-section hidden">
                <div class="blog-list-header">
                    <h2>More Articles</h2>
                    <p>Continue exploring our latest content</p>
                </div>
                <div id="more-articles-grid" class="blog-grid"></div>
            </div>
        </div>
    </main>
    
    <!-- Footer Placeholder -->
    <div id="footer-placeholder"></div>
    
    <script>
        // =============================================
        // CONFIGURATION
        // =============================================
        const BACKEND_URL = 'https://blogaura.navaura.in';
        
        // =============================================
        // BLOG LIST FUNCTIONALITY
        // =============================================
        async function loadBlogList() {
            const blogGrid = document.getElementById('blog-grid');
            
            // Show loading state
            blogGrid.innerHTML = '<div class="loading">Loading blogs...</div>';
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/blogs`);
                const data = await response.json();
                
                // API returns {blogs: [...], count: ...}
                const blogs = data.blogs || [];
                
                renderBlogGrid(blogs, 'blog-grid');
                
            } catch (error) {
                console.error('Error loading blog list:', error);
                blogGrid.innerHTML = `
                    <div class="error">
                        <h3>Unable to load blogs</h3>
                        <p>There was an error loading the blog list. Please try again later.</p>
                    </div>
                `;
            }
        }
        
        function renderBlogGrid(blogs, containerId) {
            const container = document.getElementById(containerId);
            
            if (blogs.length === 0) {
                container.innerHTML = '<p class="loading">No blogs available yet.</p>';
                return;
            }
            
            container.innerHTML = blogs.map(blog => {
                const date = new Date(blog.created_at).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                
                const keywords = blog.keywords.split(',').slice(0, 3);
                
                return `
                    <div class="blog-card" onclick="openBlog('${blog.slug}')">
                        <img src="${blog.image_url}" alt="${blog.title}" class="blog-card-image" loading="lazy">
                        <div class="blog-card-content">
                            <div class="blog-card-date">${date}</div>
                            <h3 class="blog-card-title">${blog.title}</h3>
                            <p class="blog-card-summary">${blog.summary}</p>
                            <div class="blog-card-keywords">
                                ${keywords.map(kw => `<span class="blog-card-keyword">${kw.trim()}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function openBlog(blogSlug) {
            // Update URL to include blog slug
            const newUrl = `${window.location.pathname}?slug=${blogSlug}`;
            window.history.pushState({}, '', newUrl);
            
            // Load the blog content
            loadBlog();
        }
        
        function showBlogList() {
            // Clear URL parameter
            window.history.pushState({}, '', window.location.pathname);
            
            // Show blog list, hide blog content
            document.getElementById('blog-list-container').classList.remove('hidden');
            document.getElementById('blog-content').classList.add('hidden');
            document.getElementById('more-articles-container').classList.add('hidden');
            
            // Update title and SEO
            updateSEOTags({
                title: 'Blog',
                summary: 'Explore our latest insights and articles',
                keywords: '',
                image: { url: 'https://www.navaura.in/default-blog-image.jpg' }
            });
            
            // CRITICAL FIX: Reload the blog list data
            loadBlogList();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // =============================================
        // INDIVIDUAL BLOG FUNCTIONALITY
        // =============================================
        function formatContent(content) {
            // Convert plain text paragraphs to HTML
            let formatted = content.split('\n\n').map(para => {
                para = para.trim();
                if (para.startsWith('## ')) {
                    // H2 heading
                    return `<h2>${para.substring(3)}</h2>`;
                } else if (para.startsWith('### ')) {
                    // H3 heading
                    return `<h3>${para.substring(4)}</h3>`;
                } else if (para.length > 0) {
                    // Regular paragraph
                    return `<p>${para}</p>`;
                }
                return '';
            }).join('\n');
            
            return formatted;
        }
        
        function updateSEOTags(blog) {
            const fullTitle = blog.title === 'Blog' ? 'Blog | NAVAURA‚Ñ¢ ARCTIQ' : `${blog.title} | NAVAURA‚Ñ¢ ARCTIQ`;
            const currentUrl = window.location.href;
            const imageUrl = blog.image?.url || blog.image_url || 'https://www.navaura.in/default-blog-image.jpg';
            
            // Update page title
            document.getElementById('page-title').textContent = fullTitle;
            document.title = fullTitle;
            
            // Update meta description
            document.getElementById('page-description').setAttribute('content', blog.summary);
            
            // Update keywords
            document.getElementById('page-keywords').setAttribute('content', blog.keywords || '');
            
            // Update Open Graph tags
            document.getElementById('og-title').setAttribute('content', blog.title);
            document.getElementById('og-description').setAttribute('content', blog.summary);
            document.getElementById('og-image').setAttribute('content', imageUrl);
            document.getElementById('og-url').setAttribute('content', currentUrl);
            
            // Update Twitter Card tags
            document.getElementById('twitter-title').setAttribute('content', blog.title);
            document.getElementById('twitter-description').setAttribute('content', blog.summary);
            document.getElementById('twitter-image').setAttribute('content', imageUrl);
        }
        
        async function loadBlog() {
            const urlParams = new URLSearchParams(window.location.search);
            const slug = urlParams.get('slug');
            const blogContent = document.getElementById('blog-content');
            
            if (!slug) {
                // No slug - show blog list
                document.getElementById('blog-list-container').classList.remove('hidden');
                blogContent.classList.add('hidden');
                document.getElementById('more-articles-container').classList.add('hidden');
                loadBlogList();
                return;
            }
            
            // Hide blog list, show blog content
            document.getElementById('blog-list-container').classList.add('hidden');
            blogContent.classList.remove('hidden');
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/blog/${slug}`);
                
                if (!response.ok) {
                    throw new Error('Blog not found');
                }
                
                const blog = await response.json();
                
                // Update SEO tags
                updateSEOTags(blog);
                
                // Format date
                const createdDate = new Date(blog.created_at);
                const formattedDate = createdDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                // Format content with headings
                const formattedContent = formatContent(blog.content);
                
                // Render blog
                blogContent.innerHTML = `
                    <a href="#" onclick="showBlogList(); return false;" class="back-to-list">
                        ‚Üê Back to All Articles
                    </a>
                    
                    <header>
                        <div class="meta">
                            <time datetime="${blog.created_at}">Published on ${formattedDate}</time>
                        </div>
                        <h1>${blog.title}</h1>
                        <p class="summary">${blog.summary}</p>
                    </header>
                    
                    <article>
                        <img src="${blog.image.url}" alt="${blog.title}" class="featured-image" loading="lazy">
                        
                        <div class="content">
                            ${formattedContent}
                        </div>
                        
                        <div class="keywords">
                            <strong>Related Topics</strong>
                            ${blog.keywords.split(',').map(kw => `<span>${kw.trim()}</span>`).join('')}
                        </div>
                        
                        <div class="attribution">
                            üì∏ Image: ${blog.image.attribution}
                        </div>
                    </article>
                `;
                
                // Add structured data for SEO
                const structuredData = {
                    "@context": "https://schema.org",
                    "@type": "BlogPosting",
                    "headline": blog.title,
                    "description": blog.summary,
                    "image": blog.image.url,
                    "datePublished": blog.created_at,
                    "dateModified": blog.created_at,
                    "author": {
                        "@type": "Organization",
                        "name": "NAVAURA ARCTIQ"
                    },
                    "publisher": {
                        "@type": "Organization",
                        "name": "NAVAURA ARCTIQ"
                    },
                    "mainEntityOfPage": {
                        "@type": "WebPage",
                        "@id": window.location.href
                    },
                    "keywords": blog.keywords
                };
                
                // Remove any existing structured data script
                const existingScript = document.querySelector('script[type="application/ld+json"]');
                if (existingScript) {
                    existingScript.remove();
                }
                
                const script = document.createElement('script');
                script.type = 'application/ld+json';
                script.text = JSON.stringify(structuredData);
                document.head.appendChild(script);
                
                // Load and show more articles after current blog
                loadMoreArticles(slug);
                
            } catch (error) {
                console.error('Error loading blog:', error);
                blogContent.innerHTML = `
                    <div class="error">
                        <h3>Unable to load blog</h3>
                        <p>The blog post could not be found or there was an error loading it.</p>
                        <p><a href="#" onclick="showBlogList(); return false;">‚Üê Back to blog list</a></p>
                    </div>
                `;
            }
        }
        
        async function loadMoreArticles(currentSlug) {
            try {
                const response = await fetch(`${BACKEND_URL}/api/blogs`);
                const data = await response.json();
                
                // API returns {blogs: [...], count: ...}
                const blogs = data.blogs || [];
                
                // Filter out current blog and show others
                const otherBlogs = blogs.filter(blog => blog.slug !== currentSlug).slice(0, 6);
                
                if (otherBlogs.length > 0) {
                    document.getElementById('more-articles-container').classList.remove('hidden');
                    renderBlogGrid(otherBlogs, 'more-articles-grid');
                }
                
            } catch (error) {
                console.error('Error loading more articles:', error);
            }
        }
        
        // =============================================
        // HANDLE BROWSER NAVIGATION (Back/Forward)
        // =============================================
        window.addEventListener('popstate', function() {
            loadBlog();
        });
        
        // =============================================
        // LOAD NAVIGATION AND FOOTER
        // =============================================
        fetch('/nav.html')
            .then(response => response.text())
            .then(data => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(data, 'text/html');

                // Extract components
                const nav = doc.querySelector('nav');
                const navOverlay = doc.querySelector('.nav-overlay');
                const footer = doc.querySelector('footer');
                const styles = doc.querySelector('style');

                // Inject components
                if (styles) document.head.appendChild(styles);
                if (nav) document.getElementById('navigation-placeholder').appendChild(nav);
                if (navOverlay) document.getElementById('navigation-placeholder').appendChild(navOverlay);
                if (footer) document.getElementById('footer-placeholder').appendChild(footer);

                // Re-initialize Menu Scripts (Wait for DOM update)
                setTimeout(() => {
                    const menuBtn = document.getElementById('menuToggle');
                    const overlay = document.getElementById('navOverlay');
                    const navBar = document.getElementById('mainNav');
                    const navLinks = document.querySelectorAll('.nav-links a');

                    // Menu Toggle Logic
                    if (menuBtn && overlay) {
                        menuBtn.addEventListener('click', () => {
                            overlay.classList.toggle('active');
                            if (overlay.classList.contains('active')) {
                                menuBtn.textContent = "[ CLOSE ]";
                                document.body.style.overflow = "hidden";
                            } else {
                                menuBtn.textContent = "[ MENU ]";
                                document.body.style.overflow = "";
                            }
                        });

                        // Close menu on link click
                        navLinks.forEach(link => {
                            link.addEventListener('click', () => {
                                overlay.classList.remove('active');
                                menuBtn.textContent = "[ MENU ]";
                                document.body.style.overflow = "";
                            });
                        });
                    }

                    // Scroll Logic (Glassmorphism effect)
                    window.addEventListener('scroll', () => {
                        if (window.scrollY > 50) {
                            navBar.classList.add('scrolled');
                        } else {
                            navBar.classList.remove('scrolled');
                        }
                    });

                }, 100);
            })
            .catch(err => console.error('Error loading components:', err));
        
        // Load blog when page loads
        loadBlog();
    </script>
    <script src="/chatui.js"></script>
</body>
</html>
